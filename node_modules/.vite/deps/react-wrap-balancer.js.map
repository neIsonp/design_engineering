{
  "version": 3,
  "sources": ["../../react-wrap-balancer/src/index.tsx"],
  "sourcesContent": ["'use client'\n\nimport React from 'react'\n\nconst SYMBOL_KEY = '__wrap_b'\nconst SYMBOL_OBSERVER_KEY = '__wrap_o'\nconst IS_SERVER = typeof window === 'undefined'\nconst useIsomorphicLayoutEffect = IS_SERVER\n  ? React.useEffect\n  : React.useLayoutEffect\n\ninterface WrapperElement extends HTMLElement {\n  [SYMBOL_OBSERVER_KEY]?: ResizeObserver | undefined\n}\n\ntype RelayoutFn = (\n  id: string | number,\n  ratio: number,\n  wrapper?: WrapperElement\n) => void\n\ndeclare global {\n  interface Window {\n    [SYMBOL_KEY]: RelayoutFn\n  }\n}\n\nconst relayout: RelayoutFn = (id, ratio, wrapper) => {\n  wrapper =\n    wrapper || document.querySelector<WrapperElement>(`[data-br=\"${id}\"]`)\n  const container = wrapper.parentElement\n\n  const update = (width: number) => (wrapper.style.maxWidth = width + 'px')\n\n  // Reset wrapper width\n  wrapper.style.maxWidth = ''\n\n  // Get the initial container size\n  const width = container.clientWidth\n  const height = container.clientHeight\n\n  // Synchronously do binary search and calculate the layout\n  let lower: number = width / 2 - 0.25\n  let upper: number = width + 0.5\n  let middle: number\n\n  if (width) {\n    while (lower + 1 < upper) {\n      middle = Math.round((lower + upper) / 2)\n      update(middle)\n      if (container.clientHeight === height) {\n        upper = middle\n      } else {\n        lower = middle\n      }\n    }\n\n    // Update the wrapper width\n    update(upper * ratio + width * (1 - ratio))\n  }\n\n  // Create a new observer if we don't have one.\n  // Note that we must inline the key here as we use `toString()` to serialize\n  // the function.\n  if (!wrapper['__wrap_o']) {\n    ;(wrapper['__wrap_o'] = new ResizeObserver(() => {\n      self.__wrap_b(0, +wrapper.dataset.brr, wrapper)\n    })).observe(container)\n  }\n}\n\nconst RELAYOUT_STR = relayout.toString()\n\nconst createScriptElement = (injected: boolean, suffix: string = '') => (\n  <script\n    suppressHydrationWarning\n    dangerouslySetInnerHTML={{\n      // Calculate the balance initially for SSR\n      __html: (injected ? '' : `self.${SYMBOL_KEY}=${RELAYOUT_STR};`) + suffix,\n    }}\n  />\n)\n\ninterface BalancerProps extends React.HTMLAttributes<HTMLElement> {\n  /**\n   * The HTML tag to use for the wrapper element.\n   * @default 'span'\n   */\n  as?: React.ElementType\n  /**\n   * The balance ratio of the wrapper width (0 <= ratio <= 1).\n   * 0 means the wrapper width is the same as the container width (no balance, browser default).\n   * 1 means the wrapper width is the minimum (full balance, most compact).\n   * @default 1\n   */\n  ratio?: number\n  children?: React.ReactNode\n}\n\n/**\n * An optional provider to inject the global relayout function, so all children\n * Balancer components can share it.\n */\nconst BalancerContext = React.createContext<boolean>(false)\nconst Provider: React.FC<{\n  children?: React.ReactNode\n}> = ({ children }) => {\n  return (\n    <BalancerContext.Provider value={true}>\n      {createScriptElement(false)}\n      {children}\n    </BalancerContext.Provider>\n  )\n}\n\nconst Balancer: React.FC<BalancerProps> = ({\n  as: Wrapper = 'span',\n  ratio = 1,\n  children,\n  ...props\n}) => {\n  const id = React.useId()\n  const wrapperRef = React.useRef<WrapperElement>()\n  const hasProvider = React.useContext(BalancerContext)\n\n  // Re-balance on content change and on mount/hydration.\n  useIsomorphicLayoutEffect(() => {\n    if (wrapperRef.current) {\n      // Re-assign the function here as the component can be dynamically rendered, and script tag won't work in that case.\n      ;(self[SYMBOL_KEY] = relayout)(0, ratio, wrapperRef.current)\n    }\n  }, [children, ratio])\n\n  // Remove the observer when unmounting.\n  useIsomorphicLayoutEffect(() => {\n    return () => {\n      if (!wrapperRef.current) return\n\n      const resizeObserver = wrapperRef.current[SYMBOL_OBSERVER_KEY]\n      if (!resizeObserver) return\n\n      resizeObserver.disconnect()\n      delete wrapperRef.current[SYMBOL_OBSERVER_KEY]\n    }\n  }, [])\n\n  if (process.env.NODE_ENV === 'development') {\n    // In development, we check `children`'s type to ensure we are not wrapping\n    // elements like <p> or <h1> inside. Instead <Balancer> should directly\n    // wrap text nodes.\n    if (children && !Array.isArray(children) && typeof children === 'object') {\n      if (\n        'type' in children &&\n        typeof children.type === 'string' &&\n        children.type !== 'span'\n      ) {\n        console.warn(\n          `<Balancer> should not wrap <${children.type}> inside. Instead, it should directly wrap text or inline nodes.\n\nTry changing this:\n  <Balancer><${children.type}>content</${children.type}></Balancer>\nTo:\n  <${children.type}><Balancer>content</Balancer></${children.type}>`\n        )\n      }\n    }\n  }\n\n  return (\n    <>\n      <Wrapper\n        {...props}\n        data-br={id}\n        data-brr={ratio}\n        ref={wrapperRef}\n        style={{\n          display: 'inline-block',\n          verticalAlign: 'top',\n          textDecoration: 'inherit',\n        }}\n        suppressHydrationWarning\n      >\n        {children}\n      </Wrapper>\n      {createScriptElement(hasProvider, `self.${SYMBOL_KEY}(\"${id}\",${ratio})`)}\n    </>\n  )\n}\n\n// As Next.js adds `display: none` to `body` for development, we need to trigger\n// a re-balance right after the style is removed, synchronously.\nif (!IS_SERVER && process.env.NODE_ENV !== 'production') {\n  const next_dev_style = document.querySelector<HTMLElement>(\n    '[data-next-hide-fouc]'\n  )\n  if (next_dev_style) {\n    const callback: MutationCallback = (mutationList) => {\n      for (const mutation of mutationList) {\n        for (const node of Array.from(mutation.removedNodes)) {\n          if (node !== next_dev_style) continue\n\n          observer.disconnect()\n          const elements =\n            document.querySelectorAll<WrapperElement>('[data-br]')\n\n          for (const element of Array.from(elements)) {\n            self[SYMBOL_KEY](0, +element.dataset.brr, element)\n          }\n        }\n      }\n    }\n    const observer = new MutationObserver(callback)\n    observer.observe(document.head, { childList: true })\n  }\n}\n\nexport default Balancer\nexport { Provider }\n"],
  "mappings": "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",
  "names": ["SYMBOL_KEY", "SYMBOL_OBSERVER_KEY", "IS_SERVER", "useIsomorphicLayoutEffect", "React", "relayout", "id", "ratio", "wrapper", "container", "update", "width", "height", "lower", "upper", "middle", "RELAYOUT_STR", "createScriptElement", "injected", "suffix", "BalancerContext", "Provider", "children", "Balancer", "Wrapper", "props", "wrapperRef", "hasProvider", "resizeObserver", "next_dev_style", "callback", "mutationList", "mutation", "node", "observer", "elements", "element", "src_default"]
}
